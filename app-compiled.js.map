{"version":3,"sources":["app.js"],"names":[],"mappings":"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","file":"app-compiled.js","sourcesContent":["var express = require('express');\r\nvar app = express();\r\nvar fs = require('fs');\r\nvar mysql = require('mysql');\r\nvar bodyParser = require('body-parser');\r\nvar HttpResult = require('./HttpResult');\r\nvar fileManger = require('./fileManager');\r\nvar crypto = require('crypto');\r\nvar databaseManger = require('./databaseManager');\r\n\r\nvar datasource=\"file\";// file or mysql\r\n\r\n// 跨域支持\r\napp.all('*', (req, res, next) => {\r\n  const origin = req.headers.origin;\r\n  res.header('Access-Control-Allow-Origin', origin);\r\n  res.header('Access-Control-Allow-Headers', 'Origin, X-Requested-With, Content-Type, Accept, token,sign');\r\n  res.header('Access-Control-Allow-Credentials', true);\r\n  res.header('Access-Control-Allow-Methods', 'GET, POST, PUT, OPTIONS, DELETE');\r\n  next();\r\n});\r\n\r\napp.get('/', bodyParser.json(), function (req, res) {\r\n    res.send('Hello World!!!');\r\n})\r\n\r\napp.get('/getVeryCode',bodyParser.json(),function(req,res){    \r\n    var httpResult = new HttpResult();    \r\n    //var telPhone = req.query.num;    \r\n    if(!checkSign(req,res)){        \r\n        return     \r\n    }\r\n    var codeNum = Math.floor(Math.random()*9000)+1000;\r\n    httpResult.code = 1;\r\n    httpResult.data = codeNum;\r\n    res.send(httpResult); \r\n})\r\napp.get('/users',bodyParser.json(),function(req,res){    \r\n    if(!checkSign(req,res)){       \r\n        return     \r\n    }\r\n    //if(datasource==\"file\"){\r\n    //    fileManger.getItemList(req,res);\r\n    //}else{\r\n        databaseManger.getItemList(req,res);\r\n    //}\r\n})\r\n\r\napp.post('/addUser',bodyParser.json(),function(req,res){    \r\n    if(!checkSign(req,res)){\r\n        return\r\n    } \r\n    //if(datasource==\"file\"){\r\n    //    fileManger.addItem(req,res);\r\n    //}else{\r\n        databaseManger.addItem(req,res);\r\n    //}\r\n})\r\n\r\napp.get('/page/:pageindex/:pagesize',function(req,res){\r\n    if(!checkSign(req,res)){\r\n        return\r\n    } \r\n    //if(datasource==\"file\"){\r\n    //    fileManger.setPagination(req,res);\r\n    //}else{\r\n        databaseManger.setPagination(req,res);\r\n    //}\r\n})\r\n\r\n// md5加密\r\nfunction checkSign(req,res){\r\n    var appSecret = '!Q@W#E$R';\r\n    var sign;\r\n    var md5Conent\r\n    if(req.method=='GET'){\r\n        sign=req.headers.sign;   \r\n        md5Conent = JSON.stringify(req.query) + \"|\" + appSecret;        \r\n    }\r\n    else{\r\n        sign=req.body.headers.sign;\r\n        md5Conent = JSON.stringify(req.body.params) + \"|\" + appSecret;        \r\n    }\r\n    var newSign = crypto.createHash('md5').update(md5Conent).digest('hex');\r\n    if(sign==newSign){\r\n        return true;\r\n    }\r\n    var httpResult = new HttpResult();\r\n    httpResult.code = -3;\r\n    httpResult.description = '身份认证失败！'; \r\n    res.send(httpResult);\r\n    return false;\r\n}\r\n\r\nvar server = app.listen(3000, function(){\r\n    var host = server.address().address\r\n    var port = server.address().port\r\n    console.log(\"应用实例，访问地址为 http://%s:%s\", host, port)\r\n});\r\n\r\n\r\n"]}